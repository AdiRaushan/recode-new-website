<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Case Study</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js" defer></script>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');

    :root{
      --bg: #0b0b0f;
      --bg-rgb: 11,11,15;
      --text: #e6e6e6;
      --text-secondary: #9aa0a6;
      --accent: #0c0fc4;
      --accent-rgb: 12,15,196;
      --card: #111115;
      --border: rgba(255,255,255,0.06);
      --hover: rgba(255,255,255,0.03);
      --shadow: 0 12px 30px rgba(2,6,23,0.6);
      --gradient: linear-gradient(135deg,var(--accent),#4338ca);
      --reading-width: 62ch;
      --container-max: 1100px;
    }

    [data-theme="light"]{
      --bg: #ffffff;
      --bg-rgb: 255,255,255;
      --text: #0f172a;
      --text-secondary: #6b7280;
      --accent: #3b82f6;
      --accent-rgb: 59,130,246;
      --card: #f8fafc;
      --border: rgba(15,23,42,0.06);
      --hover: rgba(15,23,42,0.03);
      --shadow: 0 10px 20px rgba(15,23,42,0.06);
      --gradient: linear-gradient(135deg,var(--accent),#1d4ed8);
    }

    *{box-sizing:border-box;margin:0;padding:0}
    html{scroll-behavior:smooth}
    body{font-family:'Inter',system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial; background:var(--bg); color:var(--text); -webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale; line-height:1.6}

    /* Layout container */
    .container{max-width:var(--container-max);margin:0 auto;padding:28px 20px}

    /* Top UI */
    .nav{padding:28px 0 8px;display:flex;align-items:center}
    .back{display:inline-flex;align-items:center;gap:10px;padding:10px 14px;background:var(--card);border:1px solid var(--border);border-radius:10px;color:var(--text);text-decoration:none;font-weight:600}
    .back i{color:var(--accent)}

    .progress-bar{position:fixed;top:0;left:0;height:3px;width:100%;transform-origin:left;transform:scaleX(0);background:var(--gradient);z-index:9999}
    .theme-toggle{position:fixed;top:18px;right:18px;background:var(--card);border:1px solid var(--border);border-radius:10px;padding:9px;cursor:pointer;z-index:1000}
    .theme-toggle i{color:var(--accent)}

    /* Header */
    .article-header{padding:28px 0 6px;text-align:left}
    .article-meta{display:flex;flex-wrap:wrap;gap:12px;margin-bottom:12px;align-items:center}
    .meta-item{display:inline-flex;align-items:center;gap:10px;color:var(--text-secondary);font-weight:600;font-size:0.95rem}
    .meta-item i{display:inline-flex;width:36px;height:36px;border-radius:8px;align-items:center;justify-content:center;background:linear-gradient(180deg, rgba(var(--accent-rgb),0.12), transparent);color:var(--accent)}

    .article-title{font-size:clamp(1.8rem,3.6vw,3rem);font-weight:800;line-height:1.05;margin:6px 0}
    .article-subtitle{color:var(--text-secondary);max-width:var(--reading-width);margin-top:6px}

    /* Hero */
    .hero-wrapper{margin:26px 0;border-radius:14px;overflow:hidden;border:1px solid var(--border);box-shadow:var(--shadow)}
    .hero{width:100%;height:clamp(240px,42vh,520px);object-fit:cover;display:block}

    /* Tools */
    .tools-section{margin:28px 0 36px}
    .tools-title{font-weight:700;color:var(--text-secondary);margin-bottom:10px}
    .tools{display:flex;flex-wrap:wrap;gap:10px}
    .tool{display:inline-flex;align-items:center;gap:10px;padding:8px 12px;background:var(--card);border:1px solid var(--border);border-radius:999px;font-weight:600}
    .tool .icon{width:30px;height:30px;border-radius:8px;display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg, rgba(var(--accent-rgb),0.12), transparent);color:var(--accent)}

    /* Main grid */
    .main-content{display:grid;grid-template-columns:1fr 320px;gap:40px;align-items:start;margin:32px 0}
    @media (max-width:1024px){.main-content{grid-template-columns:1fr;gap:28px}}

    .article-content{max-width:var(--reading-width)}
    .content-section{margin-bottom:42px;padding-bottom:12px;border-bottom:1px dashed var(--border);opacity:0;transform:translateY(14px);transition:all .55s cubic-bezier(.2,.9,.25,1)}
    .content-section.is-visible{opacity:1;transform:none}

    .section-header{display:flex;gap:14px;align-items:center;margin-bottom:14px}
    .section-icon{width:46px;height:46px;border-radius:10px;background:var(--gradient);display:flex;align-items:center;justify-content:center;color:white}
    .section-title{font-weight:700;font-size:1.125rem}

    .section-content p{color:var(--text-secondary);margin-top:6px}

    /* Testimonial */
    .testimonial{background:linear-gradient(180deg, rgba(var(--accent-rgb),0.06), transparent);padding:18px;border-radius:12px;border:1px solid var(--border);margin:20px 0}
    .testimonial p{font-weight:600}
    .testimonial .author{margin-top:10px;color:var(--text-secondary);font-size:0.95rem}

    /* Sidebar */
    .sidebar{position:sticky;top:26px}
    @media(max-width:1024px){.sidebar{position:static}}

    .sidebar-card{background:var(--card);border:1px solid var(--border);padding:18px;border-radius:12px;margin-bottom:18px}
    .sidebar-title{display:flex;align-items:center;gap:10px;font-weight:700;margin-bottom:12px}
    .fact-grid{display:grid;gap:10px}
    .fact-item {
  display: flex;
  justify-content: space-between;
  align-items: baseline;
  margin-bottom: 0.75rem;
}

.fact-label {
  font-size: 0.9rem;
  color: var(--muted);
}

.fact-value {
  font-weight: 600;
  text-align: right;
  max-width: 55%;
  word-break: break-word; /* prevents overflow */
}


    .cta-btn{display:inline-flex;align-items:center;gap:10px;padding:10px 12px;border-radius:10px;background:var(--gradient);color:white;text-decoration:none;font-weight:700}

    .gallery-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
    .gallery-img{width:100%;height:140px;object-fit:cover;border-radius:8px;border:1px solid var(--border)}

    /* TOC */
    .toc .toc-list{list-style:none;padding:0;margin:0}
    .toc-link{display:flex;align-items:center;gap:8px;padding:8px;border-radius:8px;color:var(--text-secondary);text-decoration:none}
    .toc-link.active{background:var(--accent);color:#fff}

    /* small screens tweaks */
    @media(max-width:640px){
      .container{padding:18px}
      .article-title{font-size:1.5rem}
      .gallery-grid{grid-template-columns:repeat(2,1fr)}
      .hero{height:40vh}
    }

  </style>
</head>
<body>
  <div class="progress-bar" aria-hidden="true"></div>
  <button class="theme-toggle" onclick="toggleTheme()" aria-label="Toggle theme"><i class="fas fa-moon" id="theme-icon"></i></button>

  <div class="container">
    <nav class="nav">
      <a href="index.html" class="back"><i class="fas fa-arrow-left"></i> Back to projects</a>
    </nav>

    <div id="cs-root"><!-- rendered dynamically --></div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', async () => {
      // icon map (small and safe)
      const toolIcons = { 'Next.js':'fab fa-react','React':'fab fa-react','TypeScript':'fas fa-code','JavaScript':'fab fa-js-square','Stripe':'fab fa-stripe','Tailwind CSS':'fas fa-palette','Node.js':'fab fa-node-js','GSAP':'fas fa-magic','Figma':'fab fa-figma','Vercel':'fas fa-cloud','PostgreSQL':'fas fa-database','Chart.js':'fas fa-chart-line','WordPress':'fab fa-wordpress','Elementor':'fas fa-puzzle-piece' };
      const sectionIcons = { 'Overview':'fas fa-eye','Challenge':'fas fa-exclamation-triangle','Approach':'fas fa-route','Solution':'fas fa-lightbulb','Results':'fas fa-chart-line' };
      function getToolIcon(t){return toolIcons[t]||'fas fa-code'}

      // theme
      function toggleTheme(){ const html=document.documentElement, icon=document.getElementById('theme-icon'); if(html.getAttribute('data-theme')==='light'){ html.removeAttribute('data-theme'); icon.className='fas fa-moon'; localStorage.setItem('theme','dark'); } else { html.setAttribute('data-theme','light'); icon.className='fas fa-sun'; localStorage.setItem('theme','light'); } }
      window.toggleTheme = toggleTheme;
      function loadTheme(){ const s=localStorage.getItem('theme'); const icon=document.getElementById('theme-icon'); if(s==='light'){ document.documentElement.setAttribute('data-theme','light'); icon.className='fas fa-sun'; } }

      // progress
      function updateProgressBar(){ const prog = window.scrollY / (document.documentElement.scrollHeight - window.innerHeight || 1); document.querySelector('.progress-bar').style.transform = `scaleX(${prog})`; }

      // fetch projects
      async function fetchProjects(){ try{ const r=await fetch('projects.json'); if(!r.ok) throw new Error(r.status); const j=await r.json(); if(Array.isArray(j.projects)) return j.projects; if(Array.isArray(j)) return j; return []; } catch(e){ console.warn('fetch failed', e); return window.__PROJECTS_FALLBACK||[]; } }

      function createCaseStudy(p){
        const sections = [
          {key:'overview',title:'Overview',content:p.caseStudy?.overview || p.shortDescription || ''},
          {key:'challenge',title:'Challenge',content:p.caseStudy?.challenge || ''},
          {key:'approach',title:'Approach',content:p.caseStudy?.approach || ''},
          {key:'solution',title:'Solution',content:p.caseStudy?.solution || ''},
          {key:'results',title:'Results',content:p.caseStudy?.results || ''}
        ];

        return `
          <header class="article-header">
            <div class="article-meta">
              <div class="meta-item"><i class="fas fa-folder"></i> ${p.category || ''}</div>
              <div class="meta-item"><i class="fas fa-clock"></i> ${p.duration || ''}</div>
              <div class="meta-item"><i class="fas fa-user"></i> ${p.role || ''}</div>
            </div>
            <h1 class="article-title">${p.title || ''}</h1>
            <p class="article-subtitle">${p.shortDescription || ''}</p>
          </header>

          <div class="hero-wrapper"><img class="hero" src="${p.heroImage || ''}" alt="${p.title||''}" loading="lazy"/></div>

          <section class="tools-section">
            <div class="tools-title">Built with</div>
            <div class="tools">
              ${Array.isArray(p.tools) ? p.tools.map(t=>`<span class="tool"><span class="icon"><i class="${getToolIcon(t)}"></i></span>${t}</span>`).join('') : ''}
            </div>
          </section>

          <div class="main-content">
            <article class="article-content">
              ${sections.map(s=>`
                <section class="content-section" id="${s.key}">
                  <div class="section-header">
                    <div class="section-icon"><i class="${sectionIcons[s.title] || 'fas fa-file-alt'}"></i></div>
                    <div class="section-title">${s.title}</div>
                  </div>
                  <div class="section-content"><p>${s.content}</p></div>
                </section>
              `).join('')}

              <!-- Testimonial (if exists) -->
              ${p.testimonial ? `<div class="testimonial"><p>“${p.testimonial.quote}”</p><div class="author">— ${p.testimonial.author}, ${p.testimonial.position || ''}</div></div>` : ''}

            </article>

            <aside class="sidebar">
              <div class="sidebar-card toc">
                <div class="sidebar-title"><i class="fas fa-list"></i> Contents</div>
                <ul class="toc-list">
                  ${sections.map(s=>`<li><a class="toc-link" href="#${s.key}"><i class="${sectionIcons[s.title]}"></i> ${s.title}</a></li>`).join('')}
                </ul>
              </div>

              <div class="sidebar-card">
                <div class="sidebar-title"><i class="fas fa-info-circle"></i> Project Details</div>
                <div class="fact-grid">
                  <div class="fact-item"><div class="fact-label">Category</div><div class="fact-value">${p.category || ''}</div></div>
                 <div class="fact-item">
  <div class="fact-label">Tools</div>
  <div class="fact-value">
    ${Array.isArray(p.tools) 
      ? p.tools.slice(0, 4).join(', ')
      : ''}
  </div>
</div>

                  <div class="fact-item"><div class="fact-label">Role</div><div class="fact-value">${p.role || ''}</div></div>
                  <div class="fact-item"><div class="fact-label">Timeline</div><div class="fact-value">${p.duration || ''}</div></div>
                </div>

                <div style="margin-top:12px"><a class="cta-btn" href="#contact"><i class="fas fa-rocket"></i> Start a project</a></div>
              </div>

              <div class="sidebar-card">
                <div class="sidebar-title"><i class="fas fa-images"></i> Gallery</div>
                <div class="gallery-grid">
                  ${Array.isArray(p.gallery) ? p.gallery.map(img=>`<img class="gallery-img" src="${img}" alt="gallery" />`).join('') : ''}
                </div>
              </div>
            </aside>

          </div>
        `;
      }

      // IntersectionObserver reveals + active TOC
      function observeSections(){
        const links = document.querySelectorAll('.toc-link');
        const sections = document.querySelectorAll('.content-section');
        const observer = new IntersectionObserver((entries)=>{
          entries.forEach(e=>{
            if(e.isIntersecting){
              e.target.classList.add('is-visible');
              links.forEach(l=>l.classList.toggle('active', l.getAttribute('href') === `#${e.target.id}`));
            }
          });
        }, {root:null,rootMargin:'-30% 0px -40% 0px',threshold:0.1});
        sections.forEach(s=>observer.observe(s));
      }

      // animations fallback: small entrance for header + hero
      function initEntrance(){ document.querySelector('.nav').style.opacity = 1; setTimeout(()=>{ document.querySelectorAll('.article-header, .hero-wrapper, .tools-section').forEach(el=>el.style.opacity = 1); }, 120); }

      // init main
      const slug = new URLSearchParams(location.search).get('project');
      console.log('requested slug:', slug);
      const projects = await fetchProjects();
      console.log('projects loaded:', projects.length);

      let p = projects.find(x=>x.slug === slug) || projects[0];
      if(!p){ document.getElementById('cs-root').innerHTML = `<div style="padding:36px;color:#f33">No project found. Check projects.json or slug in URL.</div>`; return; }

      document.getElementById('cs-root').innerHTML = createCaseStudy(p);
      loadTheme(); initEntrance(); observeSections(); updateProgressBar();

      // scroll events
      window.addEventListener('scroll', ()=>{ updateProgressBar(); });

      // smooth toc click
      document.querySelectorAll('.toc-link').forEach(a=>a.addEventListener('click', e=>{ e.preventDefault(); const t=document.querySelector(a.getAttribute('href')); if(t) t.scrollIntoView({behavior:'smooth',block:'start'}); }));

    });
  </script>
</body>
</html>